<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ragtag.boardhub.repository.GameMapper">

    <select id="getList" resultType="Games">
        select * from games
    </select>

    <select id="getListWithSort" resultType="Games">
        select * from games m join cate_mapping c on m.game_id = c.game_id where category_id = #{category}
    </select>

    <select id="findGameById" resultType="Games">
        select * from games where game_id = #{game_id}
    </select>

    <update id="updateGame">
        update games set
            title = #{title},
            thumbnail = #{thumbnail},
            image = #{image},
            release_date = #{release_date},
            min_player = #{min_player},
            max_player = #{max_player},
            playing_time = #{playing_time},
            min_age = #{min_age}
    </update>

    <insert id="insertGame">
        <selectKey resultType="long" keyProperty="game_id" order="BEFORE">
            select games_seq.nextval from dual
        </selectKey>
        insert into games(game_id, title, org_title, thumbnail, image, release_date, min_player, max_player, playing_time, min_age)
        values(#{game_id}, #{title}, #{org_title}, #{thumbnail}, #{image}, #{release_date}, #{min_player}, #{max_player}, #{playing_time}, #{min_age})
    </insert>

    <select id="getCategoryList" resultType="Categories">
        select * from categories
    </select>

    <select id="getMechanicList" resultType="Mechanics">
        select * from mechanics
    </select>

    <select id="getDesignerList" resultType="Designers">
        select * from designers
    </select>

    <select id="getArtistList" resultType="Artists">
        select * from artists
    </select>

    <select id="getPublisherList" resultType="Publishers">
        select * from publishers
    </select>

    <select id="getCategoriesByGameId" resultType="Categories">
        select * from categories c join cate_mapping m on c.category_id = m.category_id where m.game_id = #{game_id}
    </select>

    <select id="getMechanicsByGameId" resultType="Mechanics">
        select * from mechanics c join mech_mapping m on c.mechanic_id = m.mechanic_id where m.game_id = #{game_id}
    </select>

    <select id="getArtistsByGameId" resultType="Artists">
        select * from artists a join arti_mapping m on a.artist_id = m.artist_id where m.game_id = #{game_id}
    </select>

    <select id="getDesignersByGameId" resultType="Designers">
        select * from designers d join designer_mapping m on d.designer_id = m.designer_id where m.game_id = #{game_id}
    </select>

    <select id="getPublishersByGameId" resultType="Publishers">
        select * from publishers p join publish_mapping m on p.publisher_id = m.publisher_id where m.game_id = #{game_id}
    </select>

    <update id="updateCategoryByGameId">
        update categories set
            category = #{category},
            translate = #{translate}
        where category_id = #{category_id}
    </update>

    <select id="checkCatMapping">
        select count(*) from cate_mapping
        where category_id = #{categoryId} and game_id = #{gameId}
    </select>

    <insert id="addCatMapping">
        insert into cate_mapping(category_id, game_id)
        values(#{categoryId}, #{gameId})
    </insert>

</mapper>